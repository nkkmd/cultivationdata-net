## StressTestSimulator: 資産運用のストレステスト・シミュレーション

**概要**

このプログラムは、資産運用のストレステスト・シミュレーションを行います。通常の市場環境とストレス環境下でのポートフォリオのパフォーマンスを比較し、可視化します（取引目的や助言ではなく、情報提供のみを目的として提供されます）。プログラムは以下を行います。

* ユーザーから投資パラメータを入力
* 通常シナリオとストレスシナリオのシミュレーション
* 結果の計算と表示
* ポートフォリオ価値の推移をグラフ化

**インストール**

プログラムを実行するには以下のライブラリが必要です。

* numpy
* matplotlib

これらのライブラリは、pipを使用してインストールできます。

```bash
pip install numpy matplotlib
```

**使い方**

1. プログラムを好きな場所に保存します (e.g. `stress_test_simulator.py`)
2. コマンドプロンプトからプログラムを実行します。

```bash
python stress_test_simulator.py
```

3. プロンプトに従って、以下の情報を入力します。
   - 初期投資額（円）
   - 投資期間（年）
   - リスク許容度（1: 保守的, 2: 中庸, 3: 積極的）
   - 資産配分（株式、債券、現金の割合）
   - 想定インフレ率（%）
   - ストレスシナリオ（1: 市場急落, 2: 長期不況, 3: 高インフレ）
   - リバランス頻度（月）

**シミュレーションへの影響**

1. リスク許容度の影響:
   - 保守的: 資産クラスのリターンとボラティリティを20%減少させます。リスクを抑えた運用を想定。
   - 中庸: 資産クラスのリターンとボラティリティを変更しません。通常の運用を想定。
   - 積極的: 資産クラスのリターンとボラティリティを20%増加させます。リスクを取った運用を想定。

2. ストレスシナリオの影響:
   - 市場急落: 初期投資額を40%減少させ、リターンを50%に削減、ボラティリティを50%増加させます。短期的な市場暴落を想定。
   - 長期不況: リターンを70%削減し、ボラティリティを20%増加させます。長期的な景気後退を想定。
   - 高インフレ: リターンからインフレ率を差し引きます。高インフレ環境を想定。

3. リバランスの影響:
   指定された頻度（月数）ごとに、ポートフォリオを初期の資産配分に戻します。これにより、市場の変動に応じた定期的な調整の効果をシミュレーションに反映します。

4. 資産クラスのリターンとボラティリティの設定:
   プログラム内で`asset_returns`と`asset_volatilities`を直接編集することで、各資産クラス（株式、債券、現金）の期待リターンとボラティリティを調整できます。これにより、異なる市場環境や予測に基づいてシミュレーションをカスタマイズできます。

   ```python
   asset_returns = {
       'stocks': 0.08,  # 株式の期待リターン（例: 8%）
       'bonds': 0.03,   # 債券の期待リターン（例: 3%）
       'cash': 0.01     # 現金の期待リターン（例: 1%）
   }
   
   asset_volatilities = {
       'stocks': 0.20,  # 株式のボラティリティ（例: 20%）
       'bonds': 0.08,   # 債券のボラティリティ（例: 8%）
       'cash': 0.01     # 現金のボラティリティ（例: 1%）
   }
   ```

   これらの値を調整することで、異なる市場予測や経済シナリオに基づいたシミュレーションを実行できます。

**シミュレーションの詳細**

グラフに表示される値は、以下のような詳細なシミュレーションプロセスを経て計算されます：

1. **初期設定**:
   - ユーザーが入力した初期投資額、投資期間、リスク許容度、資産配分、インフレ率、ストレスシナリオ、リバランス頻度を基に、シミュレーションパラメータを設定します。
   - 各資産クラス（株式、債券、現金）の期待リターンとボラティリティを設定します。

2. **リスク許容度の反映**:
   - 選択されたリスク許容度に基づいて、資産クラスの期待リターンとボラティリティを調整します。
     - 保守的: 期待リターンとボラティリティを20%減少
     - 中庸: 変更なし
     - 積極的: 期待リターンとボラティリティを20%増加

3. **ポートフォリオの特性計算**:
   - 資産配分と各資産クラスの特性を基に、ポートフォリオ全体の期待リターンとボラティリティを計算します。

4. **月次リターンのシミュレーション**:
   - 投資期間の各月について、ポートフォリオの月次リターンをシミュレートします。
   - リターンは正規分布を用いて生成され、平均はポートフォリオの月次期待リターン、標準偏差はポートフォリオの月次ボラティリティです。

5. **ポートフォリオ価値の計算**:
   - 各月の終わりに、前月のポートフォリオ価値にシミュレートされた月次リターンを適用して、新しいポートフォリオ価値を計算します。

6. **リバランス**:
   - 指定されたリバランス頻度（月数）ごとに、ポートフォリオを初期の資産配分に戻します。
   - これにより、市場の変動に応じた定期的な調整の効果をシミュレーションに反映します。

7. **ストレスシナリオの適用**:
   選択されたストレスシナリオに応じて、以下の調整を行います：
   - 市場急落: 初期投資額を40%減少させ、期待リターンを50%に削減、ボラティリティを50%増加
   - 長期不況: 期待リターンを70%削減し、ボラティリティを20%増加
   - 高インフレ: 期待リターンからインフレ率を差し引く

8. **通常シナリオとストレスシナリオの並行シミュレーション**:
   - 上記のプロセスを、通常シナリオとストレスシナリオの両方で並行して実行します。
   - 両シナリオで同じ乱数シードを使用することで、市場の変動パターンを揃えています。

9. **結果の集計**:
   - 各シナリオの月次ポートフォリオ価値を記録します。
   - 投資期間の各年の年末ポートフォリオ価値を抽出します。

10. **グラフの生成**:
    - 通常シナリオとストレスシナリオの年末ポートフォリオ価値を、投資期間に沿ってプロットします。
    - X軸は経過年数、Y軸はポートフォリオ価値を示します。

このシミュレーションプロセスにより、時間の経過に伴うポートフォリオ価値の変動を、通常の市場環境とストレス環境の両方で視覚化することができます。これにより、投資戦略の潜在的なリスクと報酬を評価し、異なる市場条件下でのポートフォリオのパフォーマンスを比較することが可能になります。

**出力**

プログラムは以下の出力を生成します。

* 通常シナリオの最終ポートフォリオ価値
* ストレスシナリオの最終ポートフォリオ価値
* 通常シナリオとストレスシナリオのポートフォリオ価値推移グラフ

**注意事項**

このシミュレーションは、過去のデータや仮定に基づいており、将来の運用成績を保証するものではありません。実際の投資判断は、個人の財務状況や目標に基づいて行ってください。また、`asset_returns`と`asset_volatilities`の値を変更する際は、現実的な市場予測に基づいて行うようにしてください。